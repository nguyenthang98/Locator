angular.module("loc8rApp",["ngRoute","ngSanitize"]);function config(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationId",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("loc8rApp").config(["$routeProvider","$locationProvider",config]);(function(){e.$inject=["$scope","loc8rData","geolocation"];function e(e,t,o){var r=this;r.pageHeader={title:"Loc8r",strapline:"This is a strapline"};r.sidebar={content:"Looking for wifi and a seat Lorem ipsum dolor sit amet, consectetur adipisicing elit. Explicabo atque blanditiis assumenda, minima quas aliquam dicta natus a repellat fugit, labore obcaecati, est, sequi facilis quos hic magni molestias incidunt."};r.message="checking your location";r.data={locations:[]};r.getData=function(e){var o=e.coords.latitude;var n=e.coords.longitude;r.message="Searching for nearby places";t.locationByCoords(o,n).then(function(e){r.message=e.data.length>0?"":"No locations found nearby";r.data.locations=e.data},function(e){console.log(e.message);r.message="Sorry, something went wrong"})};r.showError=function(t){e.$apply(function(){r.message=t.message})};r.noGeo=function(){e.apply(function(){r.message="geolocation is not supported by this browser."})};o.getPosition(r.getData,r.showError,r.noGeo)}angular.module("loc8rApp").controller("homeCtrl",e)})();(function(){angular.module("loc8rApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About loc8r",strapline:""};e.main={content:"Loc8r was  created to help people find places nearby to sit down and get a bit of work done. \n\nLorem ipsum dolor sit amet, consectetur adipisicing elit. Enim veniam consectetur nesciunt dolor, vel id provident quisquam! Aliquid earum vel iusto deserunt, tenetur sequi sunt quia voluptate commodi exercitationem eos!"}}})();(function(){angular.module("loc8rApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Create a new Loc8r account"};o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All field required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";t.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();angular.module("loc8rApp").controller("loginCtrl",loginCtrl);loginCtrl.$inject=["$location","authentication"];function loginCtrl(e,t){var o=this;o.pageHeader={title:"Sign in to Loc8r"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All field required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";t.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}(function(){angular.module("loc8rApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","loc8rData","$sce","authentication"];function e(e,t,o,r,n){var a=this;a.locationId=e.locationId;a.isLoggedIn=n.isLoggedIn();a.currentPath=t.path();o.locationById(a.locationId).then(function(e){console.log(e);a.data={location:e.data};a.pageHeader={title:a.data.location.name,strapline:""};var t="https://www.google.com/maps/embed/v1/view?key=AIzaSyDj4EwB-gAC3YgEtK6dbmaquAHtIbiqdnY&center="+e.data.coordinates[1]+","+e.data.coordinates[0]+"&zoom=17&maptype=roadmap";a.mapURL=r.trustAsResourceUrl(t)},function(e){console.log(e)});a.onSubmit=function(){a.formError="";if(!a.formData.rating||!a.formData.reviewText){a.formError="All fields are required, please try again";return false}else{a.doAddReview(a.locationId,a.formData)}};a.doAddReview=function(e,t){o.addReviewById(e,{rating:t.rating,reviewText:t.reviewText}).success(function(e){$("#myModal").modal("toggle");a.data.location.reviews.push(e)}).error(function(e){a.formError="Your review has not saved, try again"});return false}}})();(function(){angular.module("loc8rApp").controller("navigationCtrl",e);e.$inject=["$route","$location","authentication"];function e(e,t,o){var r=this;r.currentPath=t.path();$("nav").find(".active").removeClass("active");switch(r.currentPath){case"/":$("#home").addClass("active");break;case"/login":case"/register":case"/about":var n=r.currentPath.replace("/","#");$(n).addClass("active");break}r.isLoggedIn=o.isLoggedIn();r.currentUser=o.currentUser();r.logout=function(){o.logout();e.reload()}}})();(function(){angular.module("loc8rApp").service("geolocation",e);function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}})();(function(){angular.module("loc8rApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var o=function(e){t.localStorage["loc8r-token"]=e};var r=function(){return t.localStorage["loc8r-token"]};register=function(t){return e.post("/api/register",t).success(function(e){o(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){o(e.token)})};logout=function(){t.localStorage.removeItem("loc8r-token")};var n=function(){var e=r();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var a=function(){if(n()){var e=r();var o=JSON.parse(t.atob(e.split(".")[1]));return{email:o.email,name:o.name}}};return{saveToken:o,getToken:r,register:register,login:login,logout:logout,currentUser:a,isLoggedIn:n}}})();(function(){angular.module("loc8rApp").service("loc8rData",e);e.$inject=["$http","authentication"];function e(e,t){var o=function(t,o){console.log(t+" and "+o);return e.get("/api/locations?lng="+o+"&lat="+t+"&maxDistance=100")};var r=function(t){return e.get("/api/locations/"+t)};var n=function(o,r){return e.post("/api/locations/"+o+"/reviews",r,{headers:{Authorization:"Bearer "+t.getToken()}})};return{locationByCoords:o,locationById:r,addReviewById:n}}})();(function(){angular.module("loc8rApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var o,r;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);r="km"}else{o=parseInt(t*1e3,10);r="m"}return o+r}else{return"?"}}}})();(function(){angular.module("loc8rApp").filter("addHtmlLineBreak",e);function e(){return function(e){return e.replace(/\n/g,"<br/>")}}})();(function(){angular.module("loc8rApp").filter("trustAsResourceUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}])})();(function(){angular.module("loc8rApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("loc8rApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("loc8rApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("loc8rApp").directive("pageHeader",e);function e(){return{retrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();